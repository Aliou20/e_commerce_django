<!DOCTYPE html>
{% load static %}
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>E-commerce</title>

    <!-- ############################################## CSS ######################################################### -->
    <link rel="stylesheet" type="text/css" href="{% static 'css/main.css' %}" />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC"
      crossorigin="anonymous"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/remixicon@2.5.0/fonts/remixicon.css"
      rel="stylesheet"
    />

    <link rel="stylesheet" type="text/css" href="https://www.paypalobjects.com/webstatic/en_US/developer/docs/css/cardfields.css"/>

    <script type="text/javascript">

      let user = "{{request.user}}";

      // ##############################################
      function getToken(name) {
        let cookieValue = null;
        if (document.cookie && document.cookie !== "") {
          const cookies = document.cookie.split(";");
          for (let i = 0; i < cookies.length; i++) {
            const cookie = cookies[i].trim();
            // Does this cookie string begin with the name we want?
            if (cookie.substring(0, name.length + 1) === name + "=") {
              cookieValue = decodeURIComponent(
                cookie.substring(name.length + 1)
              );
              break;
            }
          }
        }
        return cookieValue;
      }
      const csrftoken = getToken("csrftoken");
      
      

      // ###############################################
      function getCookie(name) {
        let cookieArr = document.cookie.split(";")

        for(let i = 0 ; i < cookieArr.length ; i++) {
          let cookiePair = cookieArr[i].split("=");

          if(name == cookiePair[0].trim()) {
            return decodeURIComponent(cookiePair[1]);
          }
        }
        return null
      }

      let cart = JSON.parse(getCookie('cart'))


      
      if(cart == undefined) {
        cart = {}
        console.log('Cart was created');
        document.cookie = 'cart=' + JSON.stringify(cart) + ";domain=;path=/"
      }
    </script>
  </head>
  <body>
    <!-- ################################################# START NAVBAR ############################################## -->
    <nav class="navbar navbar-expand-lg navbar-light bg-light">
      <div class="container-fluid mx-md-3">
        <a class="navbar-brand" href="#">
          <img src="{% static 'images/logo.svg' %}" alt="logo" />
        </a>
        <div class="d-md-none d-flex me-2">
          <div class="me-2">
            <img
              src='{% static "images/login-icon.png" %}'
              alt="login icon"
              class="icon"
            />
          </div>
          <a class="position-relative me-2" href="{% url 'cart' %}">
            <img src='{%static "images/panier-icon.png" %}' alt="panier icon" />
            <p
              class="position-absolute top-0 start-100 translate-middle cart-total"
            >
            {{cartsItems}}
            </p>
          </a>
        </div>
        <i
          class="ri-menu-line d-md-none fs-2"
          type="button"
          data-bs-toggle="collapse"
          data-bs-target="#navbarNavDropdown"
          aria-controls="navbarNavDropdown"
          aria-expanded="false"
          aria-label="Toggle navigation"
        ></i>
        <div class="collapse navbar-collapse" id="navbarNavDropdown">
          <ul class="navbar-nav">
            <li class="nav-item">
              <a
                class="nav-link active"
                aria-current="page"
                href="{% url 'store' %}"
                >Acceuil</a
              >
            </li>
            <li class="nav-item">
              <a class="nav-link" href="{% url 'cart' %}">Produit</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="#">Contact</a>
            </li>
          </ul>
        </div>
        <div class="d-md-flex ms-auto d-none">
          <button class="d-flex login">
            <div>
              <img
                src='{% static "images/login-icon.png" %}'
                alt="login icon"
                class="icon"
              />
            </div>
            <div class="">Login</div>
          </button>
          <div class="d-flex align-items-center panier">
            <a href="{% url 'cart' %}">
              <img
                class="cart-icon"
                src='{%static "images/panier-icon.png" %}'
                alt="panier icon"
              />
            </a>
            <div class="panier">Panier</div>
          </div>
          <p class="cart-total">{{cartsItems}}</p>
        </div>
        <!-- </div> -->
      </div>
    </nav>
    <!-- ##################################################### END NAVBAR ############################################ -->

    <div class="container">
      <br />
      {% block content %} {% endblock content %}
    </div>

    <!-- ################################################# JS BOOSTRAP ############################################### -->
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
      crossorigin="anonymous"
    ></script>

    <script type="text/javascript" src="{% static 'js/cart.js' %}"></script>

    
  </body>
</html>
